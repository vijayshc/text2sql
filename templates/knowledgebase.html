<!-- filepath: /home/vijay/text2sql/templates/knowledge/index.html -->
{% extends "index.html" %}

{% block head %}
{{ super() }}
<!-- Highlight.js for code highlighting -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css" rel="stylesheet">
<!-- Markdown-it for markdown rendering -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"></script>
<!-- Knowledge chat specific CSS -->
<link href="{{ url_for('static', filename='css/knowledge-chat.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Knowledge Finder</h1>
</div> -->

<!-- Chat interface -->
<div class="knowledge-chat-container">
    <!-- Search type selector -->
    <div class="search-type-selector">
        <div class="d-flex align-items-center mb-2 mt-2" style="padding-left: 5px;">
            <div class="me-2"><small class="text-muted">Search mode:</small></div>
            <div class="btn-group" role="group" aria-label="Search mode">
                <input type="radio" class="btn-check" name="search-type" id="search-knowledge" value="knowledge" checked>
                <label class="btn btn-sm btn-outline-primary" for="search-knowledge">Knowledge Base</label>
                
                <input type="radio" class="btn-check" name="search-type" id="search-metadata" value="metadata">
                <label class="btn btn-sm btn-outline-primary" for="search-metadata">Database Metadata</label>
            </div>
        </div>
    </div>

    <!-- Input area (now at the top) -->
    <div class="knowledge-input-container">
        <div class="tag-selection-container mb-2">
            <div class="d-flex align-items-center">
                <div class="me-2"><small class="text-muted">Filter by tags:</small></div>
                <div class="tag-display" id="selectedTags"></div>
                <div class="ms-auto">
                    <button class="btn btn-sm btn-outline-secondary" type="button" id="clearTagsBtn">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>
            </div>
            <div class="tag-search" id="tagSearch">
                <input type="text" class="form-control form-control-sm" id="tagSearchInput" placeholder="Type @ to search for tags...">
                <div class="tag-dropdown d-none" id="tagDropdown"></div>
            </div>
        </div>
        <div class="input-group">
            <textarea class="form-control" id="knowledgeQuery" rows="2" placeholder="Ask a question about the documents..."></textarea>
            <button class="btn btn-primary" type="button" id="sendQueryBtn">
                <i class="fas fa-paper-plane"></i> Send
            </button>
        </div>
    </div>
    
    <!-- Messages container (now below the input) -->
    <div class="knowledge-messages" id="knowledgeMessages">
        <div class="message system-message">
            <div class="avatar system-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div class="message-content">
                <p>Hello! I'm your knowledge assistant. Ask me anything about the documents in the knowledge base.</p>
            </div>
        </div>
        <!-- Messages will be added here dynamically -->
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<!-- Highlight.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<!-- Knowledge Base JS -->
<script src="{{ url_for('static', filename='js/knowledge-base.js') }}"></script>
{% endblock %}